name: Build

on:
  push:
    branches: [ master ]
  pull_request:
    branches: [ master ]

jobs:
  build-autotools:

    strategy:
      matrix:
        os: ["ubuntu-latest", "macos-latest"]
        cc: ["gcc", "clang"]

    runs-on: ${{matrix.os}}
    
    steps:
    - uses: actions/checkout@v2

    - name: autoreconf
      run: autoreconf -fi

    - name: configure
      env:
        CC: ${{matrix.cc}}
      run: CFLAGS=-Werror ./configure

    - name: make check
      run: make check

  build-cmake:
    strategy:
      matrix:
        os: ["ubuntu-latest", "macos-latest", "windows-latest"]
        cc: ["gcc", "clang"]

    runs-on: ${{matrix.os}}
    
    steps:
    - uses: actions/checkout@v2

    - name: cmake
      env:
        CC: ${{matrix.cc}}
      run: cmake .

    - name: build
      run: cmake --build .

    # todo: doesn't work on window/msvc
    - name: make check
      run: make check
